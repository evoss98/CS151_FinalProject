<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script type="text/javascript" src="http://epilog.stanford.edu/javascript/epilog.js"></script>
    <script type="text/javascript" src="http://worksheets.stanford.edu/javascript/worksheets.js"></script>
    
    <title>Kyudoku</title>
    
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">
    
    <style type="text/css">

      table {
        border: 2px solid #000000;
        text-align: center;
      }

      td {
        border: 1px solid #000000;
        text-align: center;
        vertical-align: middle;  
        font-size: 24px;
        width: 48px;
        height: 48px;
        background: white;
      }

      input {
        padding: 0;
        border: 0;
        text-align: center;
        width: 48px;
        height: 48px;
        font-size: 24px;
        outline: none;
      }

    </style>
  </head>
  <body onload='initialize()'>

    <div class="container">
      
      <h1>Kyudoku</h1>

      <table id="grid">

        <tr>
          <td id="cell(1,1)" onclick='modbutton(this)'>&nbsp;</td>
          <td id="cell(1,2)" onclick='modbutton(this)'>&nbsp;</td>
          <td id="cell(1,3)" onclick='modbutton(this)'>&nbsp;</td>
          <td id="cell(1,4)" onclick='modbutton(this)'>&nbsp;</td>
          <td id="cell(1,5)" onclick='modbutton(this)'>&nbsp;</td>
          <td id="cell(1,6)" onclick='modbutton(this)'>&nbsp;</td>
        </tr>

        <tr>
          <td id="cell(2,1)" onclick='modbutton(this)'>&nbsp;</td>
          <td id="cell(2,2)" onclick='modbutton(this)'>&nbsp;</td>
          <td id="cell(2,3)" onclick='modbutton(this)'>&nbsp;</td>
          <td id="cell(2,4)" onclick='modbutton(this)'>&nbsp;</td>
          <td id="cell(2,5)" onclick='modbutton(this)'>&nbsp;</td>
          <td id="cell(2,6)" onclick='modbutton(this)'>&nbsp;</td>
        </tr>

        <tr>
          <td id="cell(3,1)" onclick='modbutton(this)'>&nbsp;</td>
          <td id="cell(3,2)" onclick='modbutton(this)'>&nbsp;</td>
          <td id="cell(3,3)" onclick='modbutton(this)'>&nbsp;</td>
          <td id="cell(3,4)" onclick='modbutton(this)'>&nbsp;</td>
          <td id="cell(3,5)" onclick='modbutton(this)'>&nbsp;</td>
          <td id="cell(3,6)" onclick='modbutton(this)'>&nbsp;</td>
        </tr>
  
        <tr>
          <td id="cell(4,1)" onclick='modbutton(this)'>&nbsp;</td>
          <td id="cell(4,2)" onclick='modbutton(this)'>&nbsp;</td>
          <td id="cell(4,3)" onclick='modbutton(this)'>&nbsp;</td>
          <td id="cell(4,4)" onclick='modbutton(this)'>&nbsp;</td>
          <td id="cell(4,5)" onclick='modbutton(this)'>&nbsp;</td>
          <td id="cell(4,6)" onclick='modbutton(this)'>&nbsp;</td>
        </tr>

        <tr>
          <td id="cell(5,1)" onclick='modbutton(this)'>&nbsp;</td>
          <td id="cell(5,2)" onclick='modbutton(this)'>&nbsp;</td>
          <td id="cell(5,3)" onclick='modbutton(this)'>&nbsp;</td>
          <td id="cell(5,4)" onclick='modbutton(this)'>&nbsp;</td>
          <td id="cell(5,5)" onclick='modbutton(this)'>&nbsp;</td>
          <td id="cell(5,6)" onclick='modbutton(this)'>&nbsp;</td>
        </tr>
  
        <tr>
          <td id="cell(6,1)" onclick='modbutton(this)'>&nbsp;</td>
          <td id="cell(6,2)" onclick='modbutton(this)'>&nbsp;</td>
          <td id="cell(6,3)" onclick='modbutton(this)'>&nbsp;</td>
          <td id="cell(6,4)" onclick='modbutton(this)'>&nbsp;</td>
          <td id="cell(6,5)" onclick='modbutton(this)'>&nbsp;</td>
          <td id="cell(6,6)" onclick='modbutton(this)'>&nbsp;</td>
        </tr>
      </table>

      <ul>
        <li id=nineselected style='color:red'> Select 9 numbers</li>
        <li id=unique style='color:red'> All numbers selected are unique</li>
        <li id=lessthan9row style='color:red'> All row sums are less than or equal to 9</li>
        <li id=lessthan9col style='color:red'> All column sums are less than or equal to 9</li>
      </ul>

      <h1 id=winner style='visibility:hidden' >You found a winning solution!</h1>
    </div>
    <textarea id='lambda' type='text/hrf' style='display:none'>
      click2(6,4)
      square(1,1,1)
      square(1,2,6)
      square(1,3,5)
      square(1,4,9)
      square(1,5,2)
      square(1,6,2)
      square(2,1,1)
      square(2,2,3)
      square(2,3,9)
      square(2,4,6)
      square(2,5,2)
      square(2,6,7)
      square(3,1,9)
      square(3,2,4)
      square(3,3,9)
      square(3,4,4)
      square(3,5,5)
      square(3,6,9)
      square(4,1,4)
      square(4,2,2)
      square(4,3,8)
      square(4,4,2)
      square(4,5,9)
      square(4,6,8)
      square(5,1,9)
      square(5,2,4)
      square(5,3,1)
      square(5,4,4)
      square(5,5,9)
      square(5,6,3)
      square(6,1,1)
      square(6,2,1)
      square(6,3,4)
      square(6,4,1)
      square(6,5,3)
      square(6,6,8)

      correct(6,4,1)
      correct(1,6,2)
      correct(6,5,3)
      correct(3,4,4)
      correct(3,5,5)
      correct(1,2,6)
      correct(2,6,7)
      correct(4,3,8)
      correct(5,1,9)

    </textarea>
    <textarea id='library' type='text/hrf' style='display:none'>
      click(cell(X,Y)) & ~click1(X,Y) & ~click2(X,Y) & distinct(cell(X,Y), cell(6,4))==> click1(X,Y) & ~click3(X,Y)
      click(cell(X,Y)) & click1(X,Y) & distinct(cell(X,Y), cell(6,4)) ==> click2(X,Y) & ~click1(X,Y)
      click(cell(X,Y)) & click2(X,Y) & distinct(cell(X,Y), cell(6,4)) ==> click3(X,Y) & ~click2(X,Y)

      style(cell(X,Y), background, red) :- click1(X,Y)
      style(cell(X,Y), color, red) :- click1(X,Y)
      style(cell(X,Y), background, yellow) :- click2(X,Y)
      style(cell(X,Y), color, black) :- click2(X,Y)
      style(cell(X,Y), background, white) :- click3(X,Y)

      innerhtml(cell(X,Y), W) :- square(X,Y,W)

      ninetotal :- evaluate(countofall(cell(X,Y), click2(X,Y)), 9)
      allunique :- evaluate(length(setofall(W, square(X,Y,W) & click2(X, Y))), R1) & evaluate(countofall(cell(X, Y), click2(X,Y)), R2) & same(R1, R2)

      style(nineselected, color, green) :- ninetotal
      style(nineselected, color, red) :- ~ninetotal
      style(unique, color, green) :- allunique
      style(unique, color, red) :- ~allunique

      row(R) :- evaluate(max(sum(setofall(W, square(R, Y, W) & click2(R,Y))),9), 9)

      col(C) :- evaluate(max(sum(setofall(W, square(X, C, W) & click2(X, C))),9), 9)

      allrows :- row(1) & row(2) & row(3) & row(4) & row(5) & row(6)
      allcols :- col(1) & col(2) & col(3) & col(4) & col(5) & col(6)

      style(lessthan9row, color, green) :- allrows
      style(lessthan9row, color, red) :- ~allrows
      style(lessthan9col, color, green) :- allcols
      style(lessthan9col, color, red) :- ~allcols

      allsatisfied :- allrows & allcols & ninetotal & allunique
      style(winner, visibility, visible) :- allsatisfied
      style(winner, visibility, hidden) :- ~allsatisfied

      identified(X, Y, Z) :- click2(X, Y) & correct(X, Y, Z)
      clicked(Z) :- square(X, Y, Z) & click2(X, Y)

      currRowSum(R, S) :- evaluate(sum(setofall(N, identified(R, Y, N))), S)
      currColSum(C, S) :- evaluate(sum(setofall(N, identified(X, C, N))), S)

      unavailable(X, Y, Z) :- square(X, Y, Z) & currRowSum(X, S) & evaluate(min(plus(S, Z), 10), 10)
      unavailable(X, Y, Z) :- square(X, Y, Z) & currColSum(Y, S) & evaluate(min(plus(S, Z), 10), 10)
      available(X, Y, Z) :- square(X, Y, Z) & ~clicked(Z) & ~unavailable(X, Y, Z)

      hintAvailable(X, Y, Z) :- square(X, Y, Z) & available(X, Y, Z) & evaluate(countofall(cell(OX, OY), available(OX, OY, Z)), 1)

      nextHint(X, Y, Z) :- hintAvailable(X, Y, Z) & evaluate(countofall(Q, hintAvailable(OX, OY, Q) & distinct(Z, Q) & evaluate(min(Z, Q), Q)), 0)
      easyHint :- nextHint(X, Y, Z)

      canBeInRow(R, N) :- available(R, Y, N)
      canBeInCol(C, N) :- available(X, C, N)
      forcedRow(R, N) :- canBeInRow(R, N) & evaluate(countofall(OR, canBeInRow(OR, N)), 1)
      forcedCol(R, N) :- canBeInCol(C, N) & evaluate(countofall(OC, canBeInCol(OC, N)), 1)

      forcedRowSum(R, S) :- evaluate(sum(setofall(N, forcedRow(R,N))), S)
      forcedColSum(C, S) :- evaluate(sum(setofall(N, forcedCol(C,N))), S)
      totalRowSum(R, S) :- currRowSum(R, OS) & forcedRowSum(R, SS) & evaluate(plus(OS, SS), S)
      totalColSum(C, S) :- currColSum(C, OS) & forcedColSum(R, SS) & evaluate(plus(OS, SS), S)
      forcedUnavailable(X, Y, Z) :- square(X, Y, Z) & totalRowSum(X, S) & ~forcedRow(X, Z) & evaluate(min(plus(S, Z), 10), 10)
      forcedUnavailable(X, Y, Z) :- square(X, Y, Z) & totalColSum(Y, S) & ~forcedCol(Y, Z) & evaluate(min(plus(S, Z), 10), 10)

      available2(X, Y, Z) :- available(X, Y, Z) & ~forcedUnavailable(X, Y, Z)

      hardHintAvailable(X, Y, Z) :- square(X, Y, Z) & available2(X, Y, Z) & evaluate(countofall(cell(OX, OY), available2(OX, OY, Z)), 1)

      hardHint(X, Y, Z) :- ~easyHint & hardHintAvailable(X, Y, Z) & evaluate(countofall(Q, hardHintAvailable(OX, OY, Q) & distinct(Z, Q) & evaluate(min(Z, Q), Q)), 0)
      hardHint :- easyHint
      hardHint :- hardHint(X, Y, Z)

      notClobbered(N, X, Y) :- available2(OX, OY, N) & distinct(OX, X) & distinct(OY, Y)
      clobbered(N, X, Y) :- square(X, Y, W) & distinct(N, W) &  ~notClobbered(N, X, Y)
      clobberedUnavailable(X, Y, Z) :- square(X, Y, Z) & clobbered(N, X, Y) & evaluate(min(plus(N, Z), 10), 10)

      available3(X, Y, Z) :- available2(X, Y, Z) & ~clobberedUnavailable(X, Y, Z)

    </textarea>

  </body>
</html>
